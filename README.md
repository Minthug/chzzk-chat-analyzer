# 치지직 채팅 분석기 Chrome 확장 프로그램

> **v1.2.1**

치지직(chzzk.naver.com) VOD와 라이브 방송의 채팅 급증 구간을 자동으로 감지해,
영상 편집자가 편집 포인트를 쉽게 찾을 수 있도록 돕는 Chrome 확장 프로그램.

## 기능

- **채팅 자동 수집**: DOM 감지 방식으로 실시간 채팅 수집 (라이브 / VOD)
- **스파이크 감지**: Z-Score 알고리즘으로 채팅 급증 구간 자동 감지
- **오버레이 그래프**: 비디오 재생바 위에 채팅량 곡선 그래프 표시 (재생바 위치와 정확히 일치)
- **썸네일 미리보기**: 급증 구간 감지 시 해당 시점 화면을 자동 캡처해 팝업에 표시
- **급증 구간 클릭**: 그래프·목록에서 클릭 → 해당 시점으로 영상 이동
- **자동 저장**: 세션 데이터를 브라우저에 저장 (새로고침 후에도 급증 기록 유지)
- **내보내기**: `.txt` / `.csv` 형식으로 타임스탬프 내보내기

## 설치 방법

1. Chrome 주소창에 `chrome://extensions/` 입력
2. 우측 상단 **개발자 모드** 활성화
3. **압축해제된 확장 프로그램을 로드합니다** 클릭
4. `chzzk-chat-analyzer/` 폴더 선택

## 사용 방법

1. 치지직 라이브 방송 또는 VOD 페이지 접속
2. 채팅이 쌓이면 영상 재생바 위에 그래프가 자동 표시됨
3. 붉은 구간 = 채팅 급증 / 흰색 선 = 일반 채팅량
4. 확장 아이콘 클릭 → 팝업에서 채팅 급증 구간 목록 확인 및 내보내기
5. 목록의 타임스탬프 클릭 → 해당 시점으로 영상 이동
6. 각 급증 구간 옆 썸네일로 해당 시점 화면 미리 확인 가능

## 설정

팝업 하단 **설정** 항목에서 아래 두 값을 조정할 수 있습니다.

### Z-Score 임계값 (기본값: 3.0)

채팅 급증을 판단하는 민감도 기준입니다.
Z-Score는 현재 구간의 채팅량이 최근 평균보다 얼마나 튀는지를 나타내는 수치입니다.

| 값 | 의미 |
|---|---|
| **2.0** | 민감하게 감지 — 작은 반응도 잡음, 오탐 증가 |
| **3.0** | 기본값 — 일반적인 영상에 적합 |
| **4.0** | 보수적으로 감지 — 확실히 큰 반응만 잡음 |

> **낮출수록** 더 많이 감지 (오탐 ↑) / **높일수록** 덜 감지 (놓침 ↑)
> 채팅이 전반적으로 많은 대형 방송은 **3.5~4.0**, 소규모 방송은 **2.5~3.0** 권장

### 윈도우 크기 (기본값: 30초)

채팅량을 집계하는 시간 단위입니다.
`30초`면 30초마다 채팅 수를 합산해 급증 여부를 판단합니다.

| 값 | 의미 |
|---|---|
| **15초** | 짧은 단위 — 순간적인 반응(짧은 클립)에 민감 |
| **30초** | 기본값 — 대부분의 VOD에 적합 |
| **60초** | 긴 단위 — 전반적인 흐름 파악, 세부 반응은 놓칠 수 있음 |

> 짧은 하이라이트 클립 편집엔 **15~20초**, 장편 VOD 분석엔 **30~45초** 권장

### 설정 적용 방법

1. 팝업 하단 **설정** 섹션에서 값을 변경
2. **설정 저장** 버튼 클릭
3. 변경사항은 즉시 적용됨 (페이지 새로고침 불필요)

## 썸네일 미리보기

급증 구간이 감지되는 순간 해당 시점의 화면을 자동으로 캡처해 팝업 목록에 표시합니다.

```
┌────────┐  ▶ 00:12:34
│ 캡처본 │  245개/30s
│        │  3.2x Z=3.45
└────────┘
```

- 캡처는 `chrome.tabs.captureVisibleTab`을 사용하므로 **치지직 탭이 활성화된 상태**일 때만 동작
- 탭이 백그라운드에 있을 때 감지된 급증 구간은 📷 플레이스홀더로 표시
- 썸네일은 `chrome.storage.local`에 자동 저장 (새로고침 후에도 유지)

## 알고리즘

```
windowSize = 30초 (설정 가능)
lag        = 최근 10개 윈도우를 기준선으로 사용

mean  = 최근 10개 윈도우의 채팅수 평균
std   = 최근 10개 윈도우의 표준편차
Z     = (현재 윈도우 채팅수 - mean) / std

Z >= threshold → 채팅 급증 구간으로 판정
```

## 내보내기 형식

**.txt**
```
# 치지직 편집 포인트 | 채팅 급증 구간
# 페이지 ID: xxxxxx  |  생성: 2024-01-01 12:00:00

00:12:34 - 채팅 급증 (30초 245개, 평균 대비 3.2x, Z=3.45)
00:28:15 - 채팅 급증 (30초 312개, 평균 대비 4.1x, Z=4.12)
```

**.csv**
```
timestamp_hms,timestamp_sec,chat_count,avg_count,spike_ratio,z_score
00:12:34,754,245,76.2,3.21,3.45
00:28:15,1695,312,76.2,4.10,4.12
```

## 버전 히스토리

| 버전 | 주요 변경 |
|---|---|
| **v1.2.1** | SAVE_SETTINGS 구문 오류 핫픽스 (서비스 워커 등록 실패 수정) |
| **v1.2.0** | 급증 구간 썸네일 자동 캡처 및 팝업 표시, 스토리지 사용량 표시, 썸네일 ON/OFF 설정 |
| **v1.1.0** | 재생바 그래프 시간축 정확도 개선, 설정 가이드 추가 |
| **v1.0.0** | 최초 릴리즈 |

## 구조

```
chzzk-chat-analyzer/
├── manifest.json
├── src/
│   ├── background/background.js   # 스파이크 감지 엔진 + 데이터 저장
│   ├── content/
│   │   ├── page-inject.js         # MAIN world - WebSocket 폴백 (탭 숨김 시)
│   │   ├── content.js             # ISOLATED world - DOM 채팅 수집 코디네이터
│   │   └── overlay.js             # 재생바 위 채팅량 그래프 오버레이
│   └── popup/
│       ├── popup.html
│       └── popup.js
└── icons/icon128.png
```
